---
import Layout from "../../layouts/Layout.astro";
import Button from "../../components/Button.astro";
---

<Layout>
  <main>
    <section>
      <h1>Inicio de sesi√≥n</h1>
      <input
        type="text"
        id="fullname"
      />
      <input
        type="text"
        id="identifier"
      />
      <Button>Ingresar</Button>
    </section>
  </main>
</Layout>

<style>
  section {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  input {
    padding: 4px 6px;
    background-color: #ccc;
    color: black;
    margin-bottom: 5px;
    border-radius: 5px;
  }
</style>

<script>
  import { user } from "../../utils/store";

  const $fullname: HTMLInputElement = document.getElementById(
    "fullname"
  ) as HTMLInputElement;
  const $identifier: HTMLInputElement = document.getElementById(
    "identifier"
  ) as HTMLInputElement;
  const $button = document.querySelector("Button");

  $button?.addEventListener("click", () => {
    login({ fullname: $fullname?.value, identifier: $identifier?.value });
  });

  async function login(credentials: { fullname: string; identifier: string }) {
    const API_BASE = "https://o4lzmc38rd.execute-api.sa-east-1.amazonaws.com";
    const config = {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(credentials),
    };
    const result = await fetch(`${API_BASE}/auth/login`, config);
    const data = await result.json();
    user.set({
      id: data.id,
      fullname: data.fullname,
      identifier: data.identifier,
      position: data.position,
    });
  }
</script>
